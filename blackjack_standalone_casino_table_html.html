<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack — Standalone Casino Table</title>
<style>
  :root{
    --bg:#0a0f14;        /* page background */
    --felt:#0b3d2e;      /* table felt */
    --felt2:#0f6b51;     /* felt gradient */
    --panel:#0e151c;     /* side panel */
    --panel2:#121a22;    /* panel gradient */
    --ink:#f2f6f9;       /* primary text */
    --muted:#a9b6c2;     /* muted text */
    --line:#193a33;      /* table lines */
    --card:#fff;         /* card face */
    --shadow:0 10px 24px rgba(0,0,0,.35);
    --round:18px;
    --win:#34c759;
    --lose:#ff3b30;
    --warn:#ffd166;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    background: radial-gradient(1200px 800px at 70% -10%, #143e2f 0, var(--bg) 60%);
    color:var(--ink); display:flex; min-height:100vh; align-items:center; justify-content:center;
  }
  .app{ width:min(1200px,96vw); display:grid; gap:16px; grid-template-columns: 1fr 360px; padding:18px; }

  /* TABLE */
  .table{
    position:relative; overflow:hidden; border-radius:var(--round); box-shadow:var(--shadow);
    background: radial-gradient(900px 600px at 50% -10%, var(--felt2) 0, var(--felt) 55%);
    border:1px solid #0c5a45; min-height:560px; padding:18px;
  }
  .arc{ position:absolute; left:50%; transform:translateX(-50%); width:86%; height:46%; top:14%; border:2px solid var(--line); border-radius:50%/60% 60% 40% 40%; opacity:.45 }
  .labels{ position:absolute; top:8px; left:0; right:0; text-align:center; color:#d7efe5aa; font-weight:700; letter-spacing:.2em; font-size:13px }

  .seat{ position:absolute; left:50%; transform:translateX(-50%); bottom:60px; width:260px; height:140px; border:2px dashed #2a7a63; border-radius:140px / 70px; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .bet-spot{ position:absolute; left:50%; transform:translateX(-50%); bottom:90px; width:140px; height:140px; border:3px solid #2bc28f; border-radius:50%; background:#0d3d2caa; box-shadow:inset 0 0 30px #00000055; }
  .chips-on-table{ position:absolute; inset:0; pointer-events:none; }

  .row{display:flex; gap:14px; align-items:center; justify-content:flex-start; margin-top:8px}
  .hand{ display:flex; gap:12px; align-items:flex-end; min-height:168px; padding:6px 0; flex-wrap:wrap; }
  .label{ font-size:14px; color:var(--muted); letter-spacing:.04em; text-transform:uppercase; }
  .totals{ font-weight:800; font-size:18px; padding:6px 10px; border-radius:999px; background:#00000033; }
  .status{ font-size:16px; color:var(--ink); padding:10px 12px; background:#00000030; border:1px solid #ffffff1e; border-radius:12px; min-height:44px }
  .logo{ position:absolute; inset:auto 0 10px 0; text-align:center; opacity:.12; font-weight:800; letter-spacing:.25rem; user-select:none; pointer-events:none; }

  /* cards */
  .card{
    width:96px; height:140px; background:var(--card); color:#111;
    border-radius:12px; border:1px solid #d9dee6; box-shadow:0 6px 14px rgba(0,0,0,.25);
    position:relative; padding:10px; display:flex; flex-direction:column; justify-content:space-between;
    transition:transform .18s ease, box-shadow .18s ease; user-select:none;
  }
  .card:hover{transform:translateY(-3px); box-shadow:0 10px 22px rgba(0,0,0,.35)}
  .rank{font-weight:800; font-size:22px}
  .suit{font-size:22px}
  .card.red{color:#c51d34}
  .pip{position:absolute; inset:auto 10px 10px auto; opacity:.85; font-size:18px}
  .back{ background:repeating-linear-gradient(45deg,#1b2a3a,#1b2a3a 10px,#24384d 10px,#24384d 20px); border-color:#1e2d3e; }

  /* Side panel */
  .panel{
    background:linear-gradient(180deg,var(--panel2),var(--panel));
    border:1px solid #202a34; border-radius:var(--round); box-shadow:var(--shadow); padding:16px; display:flex; flex-direction:column; gap:14px;
  }
  .money{ display:grid; grid-template-columns:1fr 1fr; gap:10px; background:#0b1117; border:1px solid #1a2633; border-radius:14px; padding:12px; }
  .money .box{background:#0f1620; border:1px solid #1f2b38; border-radius:12px; padding:10px}
  .money .val{font-size:22px; font-weight:800}
  .controls{display:flex; flex-direction:column; gap:10px}
  .chips{display:flex; gap:10px; flex-wrap:wrap}
  .chip-btn{ border-radius:999px; padding:10px 14px; border:1px solid #223244; background:#0e1a25; color:var(--ink); cursor:pointer; font-weight:800; }
  .chip-btn:hover{filter:brightness(1.12)}
  .chip-btn[data-v="1"]{background:#243042; border-color:#3a4c5f}
  .chip-btn[data-v="5"]{background:#145442}
  .chip-btn[data-v="25"]{background:#3f2b14}
  .chip-btn[data-v="100"]{background:#3a163f}
  .betline{display:flex; gap:8px; align-items:center}
  input[type=number]{ width:120px; padding:10px; border-radius:10px; border:1px solid #2a3a4b; background:#0d1520; color:var(--ink); font-size:16px; }
  .btn{ padding:12px 14px; border-radius:12px; border:1px solid #244; background:#0f1c28; color:var(--ink); cursor:pointer; font-weight:700; letter-spacing:.02em; }
  .btn.primary{background:linear-gradient(180deg,#1f815c,#156247); border-color:#1d6f54}
  .btn.warn{background:linear-gradient(180deg,#a66b00,#7a4f00); border-color:#935f00}
  .btn.danger{background:linear-gradient(180deg,#be3333,#8e2626); border-color:#992a2a}
  .btn:disabled{opacity:.5; cursor:not-allowed}
  .actions{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .note{color:var(--muted); font-size:13px}
  .divider{height:1px; background:#1b2835; margin:6px 0}
  .footer{ font-size:12px; color:#a9b6c2b0; text-align:center; margin-top:-2px }

  /* chip tokens rendered on the felt */
  .chip-token{ position:absolute; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:14px; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.6); box-shadow:0 6px 14px rgba(0,0,0,.35), inset 0 0 0 3px #fff8, inset 0 0 0 6px #0002; pointer-events:none; transform:translate(-50%,-50%); }
  .chip-1{ background:#2f4a6b; }
  .chip-5{ background:#0f7a5e; }
  .chip-25{ background:#85521a; }
  .chip-100{ background:#6a1a6b; }
  .chip-locked{ filter:saturate(1.15) drop-shadow(0 4px 6px rgba(0,0,0,.4)); }
</style>
</head>
<body>
  <div class="app">
    <div class="table" id="table">
      <div class="arc"></div>
      <div class="labels">BLACKJACK PAYS 3 TO 2 — DEALER STANDS ON ALL 17</div>

      <div class="row" style="justify-content:flex-start; gap:20px; margin-top:28px">
        <div>
          <div class="label">Dealer</div>
          <div class="hand" id="dealerHand"></div>
          <div class="totals" id="dealerTotal">Total: ?</div>
        </div>
      </div>

      <div class="row" style="justify-content:flex-start; gap:20px; margin-top:22px">
        <div>
          <div class="label">Player</div>
          <div class="hand" id="playerHand"></div>
          <div class="totals" id="playerTotal">Total: 0</div>
        </div>
      </div>

      <div class="row" style="margin-top:18px">
        <div class="status" id="status">Place your chips in the betting circle, then Deal.</div>
      </div>

      <!-- Betting seat & chip layer -->
      <div class="seat"></div>
      <div class="bet-spot" id="betSpot"></div>
      <div class="chips-on-table" id="chipsLayer"></div>

      <div class="logo">BLACKJACK</div>
    </div>

    <div class="panel">
      <div class="money">
        <div class="box">
          <div class="label">Bankroll</div>
          <div class="val" id="bankroll">$0</div>
        </div>
        <div class="box">
          <div class="label">Current Bet</div>
          <div class="val" id="bet">$0</div>
        </div>
      </div>

      <div class="controls">
        <div class="label">Add Chips</div>
        <div class="chips">
          <button class="chip-btn" data-v="1">$1</button>
          <button class="chip-btn" data-v="5">$5</button>
          <button class="chip-btn" data-v="25">$25</button>
          <button class="chip-btn" data-v="100">$100</button>
        </div>
        <div class="betline">
          <input id="betInput" type="number" min="1" step="1" placeholder="Enter bet" />
          <button class="btn" id="addBet">Add to Bet</button>
          <button class="btn" id="clearBet">Clear</button>
        </div>
        <div class="note">Bets must fit your bankroll. Bets lock when you <b>Deal</b>.</div>
        <div class="divider"></div>
        <button class="btn primary" id="dealBtn" disabled>Deal</button>
        <div class="actions">
          <button class="btn" id="hitBtn" disabled>Hit</button>
          <button class="btn" id="standBtn" disabled>Stand</button>
          <button class="btn warn" id="doubleBtn" disabled>Double</button>
        </div>
        <button class="btn" id="newRoundBtn" style="display:none">New Round</button>
        <div class="divider"></div>
        <div style="display:flex; gap:10px">
          <button class="btn" id="resetBank">Reset Bankroll</button>
          <button class="btn danger" id="clearSave">Clear Save</button>
        </div>
        <div class="footer">Rules: Blackjack pays 3:2. Dealer stands on all 17. No splits/insurance. Double only on first move.</div>
      </div>
    </div>
  </div>

<script>
(() => {
  // --- Persistent bank ---
  const LS_KEY = 'bjBankroll_v2';
  const START_BANKROLL = 1000;

  // --- DOM ---
  const $ = id => document.getElementById(id);
  const dealerHandEl = $('dealerHand');
  const playerHandEl = $('playerHand');
  const dealerTotalEl = $('dealerTotal');
  const playerTotalEl = $('playerTotal');
  const statusEl = $('status');
  const bankrollEl = $('bankroll');
  const betEl = $('bet');
  const dealBtn = $('dealBtn');
  const hitBtn = $('hitBtn');
  const standBtn = $('standBtn');
  const doubleBtn = $('doubleBtn');
  const newRoundBtn = $('newRoundBtn');
  const betInput = $('betInput');
  const chipsLayer = $('chipsLayer');
  const betSpot = $('betSpot');

  // --- State ---
  let bankroll = loadBankroll();
  let bet = 0;
  let inHand = false;
  let firstDecision = false; // for double
  let dealerHoleRevealed = false;
  let deck = [];
  let player = [];
  let dealer = [];
  let chipNodes = []; // DOM nodes for current bet chips on table

  // --- Cards / Deck ---
  function buildDeck(){
    const suits = ['♠','♥','♦','♣'];
    const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const d = [];
    for (const s of suits){
      for (const r of ranks){ d.push({r,s}); }
    }
    shuffle(d); return d;
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  function needShuffle(){ return deck.length < 15; }
  function dealCard(to){ if(deck.length===0) deck=buildDeck(); to.push(deck.pop()); }
  function handValue(hand){
    let total=0, aces=0;
    for(const c of hand){ if(c.r==='A'){aces++; total+=11;} else if(['K','Q','J'].includes(c.r)) total+=10; else total+=Number(c.r); }
    while(total>21 && aces>0){ total-=10; aces--; }
    return { total };
  }
  function isBlackjack(h){ return h.length===2 && handValue(h).total===21; }

  // --- Rendering ---
  function render(){
    bankrollEl.textContent = `$${bankroll}`;
    betEl.textContent = `$${bet}`;
    renderHand(playerHandEl, player, false);
    renderHand(dealerHandEl, dealer, dealerHoleRevealed || !inHand ? false : true);
    playerTotalEl.textContent = `Total: ${handValue(player).total||0}`;
    dealerTotalEl.textContent = `Total: ${dealerHoleRevealed || !inHand ? handValue(dealer).total||0 : '?'}`;

    dealBtn.disabled = !(bet>0 && !inHand);
    hitBtn.disabled = !inHand;
    standBtn.disabled = !inHand;
    doubleBtn.disabled = !(inHand && firstDecision && bankroll>=bet);

    newRoundBtn.style.display = inHand ? 'none' : (bet===0 ? 'none' : 'inline-block');
  }

  function renderHand(container, hand, hideHole){
    container.innerHTML = '';
    hand.forEach((c,i)=>{
      const card = document.createElement('div');
      card.className='card';
      if(hideHole && i===1){ card.classList.add('back'); container.appendChild(card); return; }
      const red = (c.s==='♥'||c.s==='♦'); if(red) card.classList.add('red');
      const top = document.createElement('div'); top.className='rank'; top.textContent=c.r;
      const bottom = document.createElement('div'); bottom.className='suit'; bottom.textContent=c.s;
      const pip = document.createElement('div'); pip.className='pip'; pip.textContent=c.s;
      card.appendChild(top); card.appendChild(bottom); card.appendChild(pip);
      container.appendChild(card);
    });
  }

  function setStatus(msg, tone='info'){
    statusEl.textContent = msg;
    statusEl.style.borderColor = tone==='bad' ? '#7a2b2b' : tone==='warn' ? '#7a5b1e' : '#ffffff1e';
    statusEl.style.background = tone==='bad' ? '#2b111133' : tone==='warn' ? '#2b1f0033' : '#00000030';
  }

  function loadBankroll(){
    const v = localStorage.getItem(LS_KEY);
    const n = Number(v);
    if(Number.isFinite(n) && n>=0) return Math.floor(n);
    localStorage.setItem(LS_KEY, String(START_BANKROLL));
    return START_BANKROLL;
  }
  function saveBankroll(){ localStorage.setItem(LS_KEY, String(bankroll)); }

  // --- Chip visuals ---
  function clearChipNodes(){ chipNodes.forEach(n=>n.remove()); chipNodes=[]; }
  function addChipToTable(value){
    // Create a chip token and place it randomly within the betting circle
    const chip = document.createElement('div');
    chip.className = `chip-token chip-${value}`;
    chip.textContent = `$${value}`;
    // random polar coordinate inside circle
    const rect = betSpot.getBoundingClientRect();
    const layer = chipsLayer.getBoundingClientRect();
    const R = rect.width/2 - 18; // padding from edge
    const r = Math.sqrt(Math.random()) * R; // sqrt for uniform area
    const theta = Math.random()*Math.PI*2;
    const cx = rect.left - layer.left + rect.width/2 + r*Math.cos(theta);
    const cy = rect.top - layer.top + rect.height/2 + r*Math.sin(theta);
    chip.style.left = cx+"px"; chip.style.top = cy+"px";
    chipsLayer.appendChild(chip);
    chipNodes.push(chip);
  }
  function lockChips(){ chipNodes.forEach(n=>n.classList.add('chip-locked')); }

  // --- Flow ---
  function startHand(){
    if(bet<=0 || inHand) return;
    if(bet>bankroll){ setStatus(`Bet exceeds bankroll.`, 'bad'); return; }

    if(needShuffle()){ deck = buildDeck(); setStatus('Shuffling a fresh deck…'); } else { setStatus('Good luck!'); }

    bankroll -= bet; saveBankroll();
    inHand = true; firstDecision = true; dealerHoleRevealed = false; player=[]; dealer=[];

    // lock chips (visual)
    lockChips();

    // initial deal
    dealCard(player); dealCard(dealer); dealCard(player); dealCard(dealer);
    render();

    const pBJ = isBlackjack(player); const dBJ = isBlackjack(dealer);
    if(pBJ || dBJ){
      dealerHoleRevealed = true; render();
      if(pBJ && dBJ){ bankroll += bet; saveBankroll(); setStatus('Both have Blackjack — Push.', 'warn'); endHand(); }
      else if(pBJ){ const payout = Math.floor(bet*2.5); bankroll += payout; saveBankroll(); setStatus(`Blackjack! Payout 3:2 — You receive $${payout}.`); endHand(); }
      else { setStatus(`Dealer has Blackjack. You lose $${bet}.`, 'bad'); endHand(); }
      return;
    }
  }

  function playerHit(){ if(!inHand) return; dealCard(player); firstDecision=false; render(); const v=handValue(player).total; if(v>21){ dealerHoleRevealed=true; render(); setStatus(`Bust! You lose $${bet}.`, 'bad'); endHand(); } }
  function playerStand(){ if(!inHand) return; firstDecision=false; dealerHoleRevealed=true; dealerPlay(); }
  function playerDouble(){ if(!(inHand && firstDecision)) return; if(bankroll<bet){ setStatus('Not enough bankroll to double.', 'bad'); return; } bankroll-=bet; saveBankroll(); bet*=2; firstDecision=false; dealCard(player); render(); const v=handValue(player).total; if(v>21){ dealerHoleRevealed=true; render(); setStatus(`Bust after doubling. You lose $${bet}.`, 'bad'); endHand(); return; } playerStand(); }

  function dealerPlay(){
    const step=()=>{ const d=handValue(dealer).total; if(d<17){ setTimeout(()=>{ dealCard(dealer); render(); step(); }, 500); } else { settle(); } };
    render(); step();
  }
  function settle(){
    const p=handValue(player).total; const d=handValue(dealer).total;
    let msg='';
    if(d>21){ const payout=bet*2; bankroll+=payout; saveBankroll(); msg=`Dealer busts (${d}). You win $${payout-bet}.`; }
    else if(p>d){ const payout=bet*2; bankroll+=payout; saveBankroll(); msg=`You ${p} vs Dealer ${d}. You win $${payout-bet}.`; }
    else if(p<d){ msg=`Dealer ${d} beats your ${p}. You lose $${bet}.`; }
    else { bankroll+=bet; saveBankroll(); msg=`Push at ${p}. Your $${bet} bet is returned.`; }
    setStatus(msg, (p<d && d<=21)?'bad':(p===d?'warn':'info'));
    endHand();
  }

  function endHand(){ inHand=false; bet=0; render(); clearChipNodes(); }
  function resetRoundUI(){ dealerHoleRevealed=false; inHand=false; firstDecision=false; player=[]; dealer=[]; render(); }

  // --- Events ---
  function tryAddBet(value){
    if(inHand){ setStatus('Cannot change bet during a hand.', 'warn'); return; }
    if(bet + value > bankroll){ setStatus(`Bet exceeds bankroll ($${bankroll}).`, 'bad'); return; }
    bet += value; render(); setStatus(`Bet is now $${bet}.`);
    addChipToTable(value);
  }

  document.querySelectorAll('.chip-btn').forEach(btn=> btn.addEventListener('click', ()=>{ tryAddBet(Number(btn.dataset.v)); }));
  $('addBet').addEventListener('click', ()=>{ const v=Math.floor(Number(betInput.value)); if(!Number.isFinite(v)||v<=0){ setStatus('Enter a valid bet.', 'warn'); return; } tryAddBet(v); betInput.value=''; });
  $('clearBet').addEventListener('click', ()=>{ if(inHand){ setStatus('Cannot change bet during a hand.', 'warn'); return; } bet=0; render(); clearChipNodes(); setStatus('Bet cleared.'); });

  dealBtn.addEventListener('click', startHand);
  hitBtn.addEventListener('click', playerHit);
  standBtn.addEventListener('click', playerStand);
  doubleBtn.addEventListener('click', playerDouble);
  newRoundBtn.addEventListener('click', ()=>{ resetRoundUI(); setStatus('Place your chips, then Deal.'); });

  $('resetBank').addEventListener('click', ()=>{ if(inHand){ setStatus('Finish the hand first.', 'warn'); return; } bankroll=START_BANKROLL; saveBankroll(); setStatus(`Bankroll reset to $${START_BANKROLL}.`); render(); });
  $('clearSave').addEventListener('click', ()=>{ if(inHand){ setStatus('Finish the hand first.', 'warn'); return; } localStorage.removeItem(LS_KEY); bankroll=START_BANKROLL; saveBankroll(); clearChipNodes(); bet=0; render(); setStatus('Save cleared.'); });

  // keyboard shortcuts
  window.addEventListener('keydown', (e)=>{ const k=e.key.toLowerCase(); if(k==='h') playerHit(); if(k==='s') playerStand(); if(k==='d') playerDouble(); if(k==='enter') startHand(); });

  // --- Init ---
  deck = buildDeck(); setStatus('Place your chips in the circle, then Deal.'); render();
})();
</script>
</body>
</html>
